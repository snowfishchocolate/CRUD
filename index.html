<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>
  </head>
  <style>
    .buttons {
      width: 200px;
      height: 80px;
      margin-top: 20px;
    }
  </style>
  <body>
    <div class="container">
      <div class="row align-items-start">
        <div class="col">
          <table class="table table-striped" id="mytable">
            <thead>
              <tr>
                <th>
                  <select id="pri">
                    <option value="甲班">甲班</option>
                    <option value="乙班">乙班</option>
                    <option value="丙班">丙班</option>
                  </select>
                </th>
                <th>
                  <button id="search">搜尋</button>
                </th>
              </tr>
              <tr>
                <th scope="col">勾選</th>
                <th scope="col">id</th>
                <th scope="col">姓名</th>
                <th scope="col">密碼</th>
                <th scope="col">生日</th>
                <th scope="col">地址</th>
                <th scope="col">按鈕</th>
              </tr>
              <tr>
                <td><input type="checkbox" onclick="checkAll(this)" /></td>
                <td colspan="6">
                  <a
                    href="javascript:;"
                    class="btn btn-danger"
                    role="button"
                    onclick="delAll(this)"
                    >全部删除</a
                  >
                </td>
              </tr>
            </thead>
            <tbody id="listbody">
              <tr>
                <td><input type="checkbox" name="item" /></td>
                <td class="ser">乙班</td>
                <td>Mark</td>
                <td>123</td>
                <td>1990/6/6</td>
                <td>fgfdgdfg</td>
                <td>
                  <input
                    type="button"
                    name=""
                    value="删除"
                    class="btn btn-danger"
                    onclick="del(this)"
                  />
                  <input
                    type="button"
                    name=""
                    value="修改"
                    class="btn btn-info"
                    onclick="edit(this)"
                  />
                </td>
              </tr>
            </tbody>
          </table>
          <form>
            <table>
              <tr>
                <th>id</th>
                <td>
                  <select id="id">
                    <option value="甲班">甲班</option>
                    <option value="乙班">乙班</option>
                    <option value="丙班">丙班</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th>姓名</th>
                <td><input type="text" id="name" /></td>
              </tr>
              <tr>
                <th>密碼</th>
                <td><input type="text" id="pass" /></td>
              </tr>
              <tr>
                <th>生日</th>
                <td><input type="date" id="brith" /></td>
              </tr>
              <tr>
                <th>地址</th>
                <td><input type="text" id="address" /></td>
              </tr>

              <tr>
                <td class="buttons">
                  <button type="button" class="btn btn-warning">清空</button>
                  <button type="button" class="btn btn-success" onclick="add()">
                    新增
                  </button>
                  <button type="button" class="btn btn-info" onclick="update()">
                    更新
                  </button>
                </td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>

    <script>
      function add() {
        var ser = document.getElementsByClassName("ser");
        var id = document.querySelector("#id").value;
        var name = document.getElementById("name").value;
        var passWord = document.getElementById("pass").value;
        var brith = document.getElementById("brith").value;
        var address = document.getElementById("address").value;
        var table = document.createElement("tr");
        var column = document.createElement("td");
        var input = document.createElement("input");
        column.appendChild(input);
        input.setAttribute("type", "checkbox");
        input.setAttribute("name", "item");

        var oTd1 = document.createElement("td");
        oTd1.innerHTML = id;
        oTd1.className = "ser";
        var oTd2 = document.createElement("td");
        oTd2.innerHTML = name;
        console.log(name);
        var oTd3 = document.createElement("td");
        oTd3.innerHTML = passWord;
        var oTd4 = document.createElement("td");
        oTd4.innerHTML = brith;
        var oTd5 = document.createElement("td");
        oTd5.innerHTML = address;
        var buttons = document.createElement("td");
        var delBtn = document.createElement("input");
        var editBtn = document.createElement("input");
        delBtn.setAttribute("type", "button");
        delBtn.setAttribute("value", "删除");
        delBtn.setAttribute("onclick", "del(this)");
        delBtn.className = "btn btn-danger";
        editBtn.setAttribute("type", "button");
        editBtn.setAttribute("value", "修改");
        editBtn.setAttribute("onclick", "edit(this)");
        editBtn.className = "btn btn-info";
        buttons.appendChild(delBtn);
        buttons.appendChild(editBtn);
        table.appendChild(column);
        table.appendChild(oTd1);
        table.appendChild(oTd1);
        table.appendChild(oTd2);
        table.appendChild(oTd3);
        table.appendChild(oTd4);
        table.appendChild(oTd5);
        table.appendChild(buttons);
        var listBody = document.getElementById("listbody");
        listBody.appendChild(table);
      }
      function del(obj) {
        console.log(obj);
        if (confirm("確定要刪除嗎?")) {
          var oParentnode = obj.parentNode.parentNode;
          console.log(oParentnode);
          var listBody = document.getElementById("listbody");
          listBody.removeChild(oParentnode);
        }
      }
      ////////////全選//////////////
      function checkAll(checkbox) {
        var status = checkbox.checked;
        var item = document.getElementsByName("item");
        for (var i = 0; i < item.length; i++) {
          console.log(item.length);
          item[i].checked = status;
        }
      }
      //////////////delall//////////
      function delAll() {
        if (confirm("確定要刪除嗎?")) {
          var listBody = document.getElementById("listbody");
          var items = document.getElementsByName("item");
          for (var i = 0; i < items.length; i++) {
            if (items[i].checked) {
              //如果item被选中
              var oParentnode = items[i].parentNode.parentNode;
              listBody.removeChild(oParentnode);
              i--;
            }
          }
        }
      }
      //////////////////////修改///////////
      function edit(obj) {
        var id = document.getElementById("id").value;
        var name = document.getElementById("name").value;
        var passWord = document.getElementById("pass").value;
        var brith = document.getElementById("brith").value;
        var address = document.getElementById("address").value;
        var oTr = obj.parentNode.parentNode;
        var aTd = document.getElementsByTagName("td");
        console.log(aTd);
        rowIndex = obj.parentNode.parentNode.rowIndex;
        id.value = aTd[3].innerHTML;
        name.value = aTd[4].innerHTML;
        passWord.value = aTd[5].innerHTML;
        brith.value = aTd[6].innerHTML;
        address.value = aTd[7].innerHTML;
        console.log(aTd[9].innerHTML);
      }
      /////////////////update///////////////////
      function update(obj) {
        var id = document.getElementById("id").value;
        var name = document.getElementById("name").value;
        var passWord = document.getElementById("pass").value;
        var brith = document.getElementById("brith").value;
        var address = document.getElementById("address").value;
        var myTable = document.getElementById("mytable");
        myTable.rows[rowIndex].cells[1].innerHTML = id;
        myTable.rows[rowIndex].cells[2].innerHTML = name;
        myTable.rows[rowIndex].cells[3].innerHTML = passWord;
        myTable.rows[rowIndex].cells[4].innerHTML = brith;
        myTable.rows[rowIndex].cells[5].innerHTML = address;
        console.log(rowIndex);
      }
      /////////search//////////
      var ser = document.getElementsByClassName("ser");//班級的class//
      var listBody = document.getElementById("listbody");
      // var pri = document.getElementById("c");
      var pri = document.getElementById("pri");//班級選單//
      var bcd = pri.value;
      pri.onchange = function () {
        var index = pri.selectedIndex;
        bcd = pri[index].innerText;
      };
      var searchBtn = document.getElementById("search");
      searchBtn.onclick = function () {
        var tr = document.querySelectorAll("#listbody tr");
        var str = [];
        for (var j = 0; j < tr.length; j++) {
          var a1 = tr[j].querySelector(".ser");//a1是某一筆資料裡面的班級class//
          console.log(bcd, a1.innerText);
          if (bcd == a1.innerText) {
            str.push(tr[j]);//把找到的資料加入陣列當中//
          }
        }
        //删除所有行
        for (var k = 0; k < tr.length; k++) {
          tr[k].remove();
        }
        //添加找到的行
        str.forEach(function (e) {
          listBody.appendChild(e);
        });
      };
    </script>
  </body>
</html>
